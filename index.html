<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マラソン電卓</title>
    <!-- Tailwind CSS を読み込む -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Interフォントを設定 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* 薄いグレーの背景 */
        }
    </style>
</head>
<body class="flex items-center justify-center p-2 sm:p-4 min-h-screen">
    <div class="bg-white p-3 sm:p-4 rounded-lg shadow-xl w-full max-w-md border border-gray-200">
        <h1 class="text-2xl sm:text-3xl font-bold text-center mb-3 text-gray-800">マラソン電卓</h1>

        <!-- 表示エリア -->
        <div class="mb-3 bg-gray-100 p-3 rounded-md border border-gray-300">
            <div class="flex justify-between items-center mb-1">
                <span class="text-gray-600 text-sm sm:text-base">選択距離:</span>
                <span id="display-distance" class="text-blue-600 font-semibold text-base sm:text-lg">-- km</span>
            </div>
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-600 text-sm sm:text-base">合計時間 (分):</span>
                <input type="text" id="display-time-input" class="w-2/3 text-right text-green-700 font-bold text-xl sm:text-2xl bg-gray-100 focus:outline-none" value="0" readonly>
            </div>
            <hr class="border-gray-300 my-2">
            <div class="text-center">
                <p class="text-gray-700 text-sm sm:text-base mb-1">1kmあたりのタイム:</p>
                <p id="display-pace" class="text-indigo-700 font-bold text-xl sm:text-2xl mb-2">--:-- /km</p>
                <p class="text-gray-700 text-sm sm:text-base mb-1">スピード (km/h):</p>
                <p id="display-speed" class="text-red-600 font-bold text-xl sm:text-2xl">-- km/h</p>
            </div>
        </div>

        <!-- 距離ボタン -->
        <div class="grid grid-cols-3 gap-1 mb-3">
            <button id="btn-42km" class="bg-purple-600 text-white py-2 rounded-md text-xs sm:text-sm font-semibold hover:bg-purple-700 transition duration-200 shadow-md">
                42km (フル)
            </button>
            <button id="btn-21km" class="bg-purple-600 text-white py-2 rounded-md text-xs sm:text-sm font-semibold hover:bg-purple-700 transition duration-200 shadow-md">
                21km (ハーフ)
            </button>
            <button id="btn-10km" class="bg-purple-600 text-white py-2 rounded-md text-xs sm:text-sm font-semibold hover:bg-purple-700 transition duration-200 shadow-md">
                10km
            </button>
        </div>

        <!-- 数字ボタン -->
        <div class="grid grid-cols-3 gap-1">
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">7</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">8</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">9</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">4</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">5</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">6</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">1</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">2</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">3</button>
            <button id="btn-clear" class="bg-red-500 text-white py-2 rounded-md text-base sm:text-lg font-bold hover:bg-red-600 transition duration-200 shadow-md">クリア</button>
            <button class="btn-number bg-gray-300 text-gray-800 py-2 rounded-md text-lg sm:text-xl font-bold hover:bg-gray-400 transition duration-200 shadow-sm">0</button>
            <button id="btn-calculate" class="bg-blue-500 text-white py-2 rounded-md text-base sm:text-lg font-bold hover:bg-blue-600 transition duration-200 shadow-md">計算</button>
        </div>
    </div>

    <script>
        // DOM要素の参照を取得
        const displayDistance = document.getElementById('display-distance');
        const displayTimeInput = document.getElementById('display-time-input');
        const displayPace = document.getElementById('display-pace');
        const displaySpeed = document.getElementById('display-speed');
        const btn42km = document.getElementById('btn-42km');
        const btn21km = document.getElementById('btn-21km');
        const btn10km = document.getElementById('btn-10km');
        const btnClear = document.getElementById('btn-clear');
        const btnCalculate = document.getElementById('btn-calculate');
        const numberButtons = document.querySelectorAll('.btn-number');

        // アプリケーションの状態を管理する変数
        let currentDistance = 0; // 選択された距離 (km)
        let inputTime = '0';     // 入力された合計時間 (分)

        /**
         * 入力値と選択距離を表示する関数
         * 計算は行わない
         */
        function updateInputDisplay() {
            // フルマラソン、ハーフマラソンの正確な距離を表示するため、toFixed(3)を使用
            displayDistance.textContent = currentDistance > 0 ? `${currentDistance.toFixed(3)} km` : '-- km';
            displayTimeInput.value = inputTime;
            // 計算結果はクリアされたままにするか、初期値に戻す
            displayPace.textContent = '--:-- /km';
            displaySpeed.textContent = '-- km/h';
        }

        /**
         * 1kmあたりのタイムとスピードを計算し表示する関数
         */
        function calculateAndDisplayResults() {
            // 現在の入力値を取得
            const distance = currentDistance;
            const time = parseFloat(inputTime);

            if (distance > 0 && time > 0) {
                const totalMinutes = time;
                const totalHours = totalMinutes / 60; // 合計時間を時間に変換

                // 1kmあたりの時間 (分/km)
                const paceMinutesPerKm = totalMinutes / distance;
                const paceMinutes = Math.floor(paceMinutesPerKm); // 分の部分
                const paceSeconds = Math.round((paceMinutesPerKm - paceMinutes) * 60); // 秒の部分

                // 秒を2桁表示にフォーマット
                const formattedPaceSeconds = paceSeconds < 10 ? '0' + paceSeconds : paceSeconds;
                displayPace.textContent = `${paceMinutes}:${formattedPaceSeconds} /km`;

                // スピード (km/h)
                const speedKmh = distance / totalHours;
                displaySpeed.textContent = `${speedKmh.toFixed(1)} km/h`; // 小数点以下1桁で表示
            } else {
                // 有効なデータがない場合は初期表示に戻す
                displayPace.textContent = '--:-- /km';
                displaySpeed.textContent = '-- km/h';
            }
        }

        /**
         * 数字ボタンクリック時の処理
         * @param {Event} event - クリックイベント
         */
        numberButtons.forEach(button => {
            button.addEventListener('click', (event) => {
                const digit = event.target.textContent;
                // '0'が入力されている状態でさらに'0'を入力しても変化させない
                if (inputTime === '0' && digit === '0') {
                    return;
                }
                // 最初の入力が'0'であれば、新しい数字で置き換える
                if (inputTime === '0') {
                    inputTime = digit;
                } else {
                    // 入力桁数に制限を設ける（例: 5桁まで、一般的なマラソンタイムは分単位で5桁を超えることは稀）
                    if (inputTime.length < 5) {
                       inputTime += digit;
                    }
                }
                updateInputDisplay(); // 入力値と距離表示のみを更新、計算結果はリセット
            });
        });

        /**
         * 距離ボタンクリック時の処理
         * @param {number} distance - 設定する距離
         */
        function setDistance(distance) {
            currentDistance = distance;
            updateInputDisplay(); // 距離表示のみを更新、計算結果はリセット
        }

        // 距離ボタンにイベントリスナーを追加
        btn42km.addEventListener('click', () => setDistance(42.195)); // フルマラソンは正確な距離に
        btn21km.addEventListener('click', () => setDistance(21.0975)); // ハーフマラソンも正確な距離に
        btn10km.addEventListener('click', () => setDistance(10));

        /**
         * クリアボタンクリック時の処理
         */
        btnClear.addEventListener('click', () => {
            currentDistance = 0;
            inputTime = '0';
            updateInputDisplay(); // 表示をリセット (距離、時間、計算結果すべて)
        });

        /**
         * 計算ボタンクリック時の処理
         */
        btnCalculate.addEventListener('click', () => {
            calculateAndDisplayResults(); // ここで計算と結果表示を行う
        });

        // 初期表示を更新（計算結果は空の状態で開始）
        updateInputDisplay();
    </script>
</body>
</html>
